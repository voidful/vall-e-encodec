import torch
from transformers import AutoTokenizer

from encodec_longt5_model import LongT5EncodecForConditionalGeneration

tokenizer = AutoTokenizer.from_pretrained("voidful/long-t5-encodec-tglobal-base")
model = LongT5EncodecForConditionalGeneration.from_pretrained("voidful/long-t5-encodec-tglobal-base")

encodec_input = torch.tensor([[62, 62, 62, 62, 408, 408, 62, 408, 408, 408, 408, 408, 408, 62, 408, 677, 103, 38, 38,
                               677, 23, 370, 933, 348, 839, 414, 414, 414, 755, 755, 876, 855, 855, 904, 855, 904, 855,
                               106, 855, 106, 73, 488, 143, 681, 723, 645, 456, 11, 385, 385, 936, 432, 103, 103, 53,
                               53, 433, 463, 463, 53, 103, 53, 148, 237, 433, 955, 385, 505, 23, 738, 835, 835, 835,
                               835, 408, 408, 738, 738, 213, 53, 53, 53, 53, 53, 53, 148, 103, 53, 463, 463, 339, 121,
                               835, 835, 731, 38, 276, 276, 1011, 875, 283, 679, 722, 456, 456, 465, 561, 977, 807, 945,
                               344, 583, 344, 583, 565, 310, 699, 976, 491, 699, 976, 583, 976, 491, 699, 208, 976, 860,
                               875, 430, 835, 106, 408, 1019, 738, 738, 408, 408, 408, 408, 408, 408, 62, 62, 62, 62,
                               62, 62, 62, 62, 62, 62, 62, 62, 62, 62, 62, 62, 62, 62, 62, 62, 62, 62, 62, 62, 62, 62,
                               62, 62, 62, 62, 62, 62, 62, 62, 62, 62, 62, 62, 62, 62, 62, 62, 62, 62, 62, 62, 62, 62,
                               62, 62, 62, 62, 62, 62, 62, 62, 62, 62, 62, 62, 62, 62, 62, 62, 62, 62, 62, 62, 62, 62,
                               62, 62, 62, 62, 62, 62, 62, 62, 62, 62, 62, 62, 62, 62, 62, 62, 62, 62, 62, 62, 62, 62,
                               62, 62, 62, 62, 62, 62, 62, 62, 62, 835, 408, 62, 62, 62, 62, 62, 62, 62, 404, 203, 203,
                               118, 233, 51, 531, 982, 605, 465, 813, 531, 596, 531, 560, 697, 938, 938, 903, 8, 348,
                               958, 890, 931, 598, 604, 347, 604, 872, 982, 862, 806, 573, 862, 722, 813, 11, 604, 373,
                               373, 373, 904, 408, 106, 738, 602, 496, 731, 499, 11, 182, 681, 288, 658, 983, 890, 288,
                               890, 612, 723, 424, 753, 432, 310, 724, 724, 25, 53, 872, 23, 945, 945, 977, 977, 385,
                               1004, 925, 925, 945, 977, 931, 722, 722, 936, 881, 293, 819, 635, 463, 463, 537, 339,
                               339, 339, 395, 753, 955, 949, 1010, 724, 724, 432, 1017, 228, 228, 131, 407, 23, 23, 224,
                               604, 1019, 876, 738, 62, 677, 731, 906, 943, 411, 937, 820, 820, 59, 1021, 953, 901, 679,
                               681, 943, 479, 1021, 804, 945, 945, 530, 530, 530, 70, 807, 807, 456, 694, 575, 983, 860,
                               208, 228, 604, 676, 724, 724, 724, 432, 563, 1021, 804, 937, 722, 604, 731, 38, 53, 53,
                               53, 148, 373, 53, 53, 537, 780, 835, 835, 887, 887, 1017, 862, 1021, 804, 465, 727, 385,
                               385, 681, 407, 407, 645, 727, 958, 937, 796, 43, 914, 808, 385, 681, 407, 407, 804, 945,
                               875, 53, 53, 53, 731, 463, 731, 321, 239, 950, 414, 20, 977, 983, 925, 20, 1004, 216,
                               402, 112, 925, 561, 977, 1004, 530, 344, 1010, 561, 344, 1010, 530, 344, 1010, 561, 530,
                               310, 976, 432, 976, 904, 904, 208, 860, 598, 224, 901, 424, 645, 813, 385, 385, 80, 977,
                               804, 804, 734, 679, 942, 604, 779, 463, 103, 537, 537, 537, 537, 537, 935, 339, 255, 136,
                               23, 23, 982, 901, 563, 890, 70, 306, 890, 306, 945, 598, 30, 860, 860, 565, 1001, 424,
                               683, 392, 99, 739, 830, 804, 233, 456, 456, 755, 421, 747, 747, 747, 747, 977, 216, 23,
                               344, 1011, 565, 293, 976, 491, 583, 976, 491, 1010, 491, 699, 976, 583, 976, 583, 131,
                               724, 463, 463, 463, 463, 463, 373, 463, 433, 463, 25, 25, 475, 62, 780, 62, 62, 62, 62,
                               62, 62, 62, 62, 62, 62, 62, 62, 62, 62, 62, 62, 62, 62, 62, 62, 62, 62, 62, 62, 62, 62,
                               62, 62, 62, 62, 62, 62, 62, 62, 62, 62, 62, 629, 566, 326, 804, 208, 567, 550, 954, 233,
                               716, 413, 820, 808, 837, 306, 945, 224, 982, 306, 804, 451, 695, 501, 437, 695, 501,
                               1021, 136, 651, 143, 875, 52, 38, 103, 433, 143, 982, 635, 604, 604, 228, 432, 276, 433,
                               23, 23, 23, 70, 563, 424, 645, 325, 1019, 604, 677, 722, 233, 59, 565, 463, 53, 899, 53,
                               373, 373, 148, 237, 53, 103, 433, 224, 407, 424, 906, 23, 465, 955, 901, 465, 681, 804,
                               385, 291, 690, 666, 73, 276, 983, 402, 216, 99, 601, 937, 185, 43, 860, 463, 819, 635,
                               373, 537, 1022, 696, 203, 203, 424, 505, 563, 495, 424, 901, 495, 385, 23, 463, 38, 38,
                               496, 373, 373, 103, 373, 53, 148, 148, 408, 121, 835, 537, 246, 413, 269, 99, 771, 688,
                               348, 348, 950, 523, 738, 604, 904, 855, 904, 106, 904, 106, 106, 106, 430, 862, 392, 414,
                               414, 688, 575, 288, 925, 925, 456, 807, 807, 1010, 807, 807, 385, 804, 411, 385, 738,
                               106, 779, 408, 677, 38, 103, 798, 323, 91, 393, 779, 835, 475, 52, 955, 563, 224, 598,
                               875, 860, 724, 876, 121, 62, 738, 38, 731, 276, 666, 666, 862, 585, 645, 681, 414, 348,
                               813, 414, 414, 414, 658, 983, 955, 155, 1010, 344, 565, 753, 1010, 344, 1010, 344, 1010,
                               530, 1010, 530, 344, 1010, 724, 472, 887, 106, 106, 62, 408, 408, 408, 408, 408, 62, 62,
                               62, 62, 62, 62, 62, 62, 62, 62, 62, 62, 62, 62, 62, 62, 62, 62, 62, 62, 62, 62, 62, 62,
                               62, 62, 62, 62, 408, 393, 203, 793, 240, 739, 870, 830, 739, 903, 99, 411, 413, 645, 465,
                               407, 944, 604, 432, 855, 855, 855, 773, 53, 38, 38, 731, 677, 276, 224, 612, 858, 858,
                               858, 890, 70, 949, 681, 949, 385, 945, 860, 604, 228, 228, 604, 887, 11, 393, 339, 310,
                               80, 11, 11, 505, 505, 415, 415, 23, 23, 598, 23, 879, 834, 408, 408, 433, 549, 38, 73,
                               323, 323, 228, 813, 1001, 860, 971, 890, 563, 837, 378, 613, 112, 982, 432, 813, 413,
                               392, 99, 348, 392, 747, 291, 224, 463, 463, 373, 463, 537, 91, 203, 203, 723, 291, 182,
                               143, 136, 982, 813, 239, 679, 722, 982, 688, 348, 392, 683, 112, 203, 11, 182, 224, 604,
                               404, 904, 257, 393, 91, 323, 976, 182, 11, 11, 11, 11, 901, 505, 505, 415, 424, 645, 385,
                               977, 860, 1019, 1019, 834, 779, 325, 976, 228, 432, 310, 724, 208, 30, 43, 808, 681, 723,
                               582, 185, 385, 1021, 679, 325, 276, 677, 103, 103, 103, 103, 103, 103, 103, 103, 103, 25,
                               25, 25, 835, 835, 408, 835, 25, 103, 276, 408, 62, 408, 62, 408, 408, 835, 408]])
encodec_input = encodec_input.repeat(1, 7, 1)
print(encodec_input.shape)
print(model(input_ids=encodec_input,
            labels=tokenizer("hello world", return_tensors="pt").input_ids).loss)
